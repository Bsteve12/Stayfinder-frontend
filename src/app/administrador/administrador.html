<div class="dashboard-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-content">
      <!-- Logo -->
      <div class="logo-section">
        <img src="StayFinder.png" alt="StayFinder" class="logo" />
        <span class="logo-text">StayFinder</span>
      </div>

      <!-- Menú de navegación -->
      <nav class="menu">
        <button 
          class="menu-item"
          [class.active]="currentView === 'perfil'"
          (click)="changeView('perfil')"
        >
          Perfil del administrador
        </button>

        <button 
          class="menu-item"
          [class.active]="currentView === 'solicitud-publicaciones'"
          (click)="changeView('solicitud-publicaciones')"
        >
          Solicitud publicaciones
        </button>

        <button 
          class="menu-item"
          [class.active]="currentView === 'solicitud-anfitriones'"
          (click)="changeView('solicitud-anfitriones')"
        >
          Solicitud de anfitriones
        </button>

        <button 
          class="menu-item"
          [class.active]="currentView === 'asignar-rol'"
          (click)="changeView('asignar-rol')"
        >
          Asignar rol
        </button>

        <button 
          class="menu-item"
          [class.active]="currentView === 'listar-usuarios'"
          (click)="changeView('listar-usuarios')"
        >
          Listar usuarios
        </button>

        <button 
          class="menu-item"
          [class.active]="currentView === 'listar-por-rol'"
          (click)="changeView('listar-por-rol')"
        >
          Listar usuarios por rol
        </button>

        <button 
          class="menu-item"
          [class.active]="currentView === 'crear-usuario'"
          (click)="changeView('crear-usuario')"
        >
          Crear usuario
        </button>
      </nav>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="content-header">
      <h1 class="page-title">
        {{ currentView === 'perfil' ? 'Perfil del Administrador' : 
           currentView === 'solicitud-publicaciones' ? 'Solicitudes de Publicación' :
           currentView === 'solicitud-anfitriones' ? 'Solicitudes de Anfitriones' :
           currentView === 'asignar-rol' ? 'Asignar Rol' :
           currentView === 'listar-usuarios' ? 'Listar Usuarios' :
           currentView === 'listar-por-rol' ? 'Listar Usuarios por Rol' :
           'Crear Usuario' }}
      </h1>
      <button pButton icon="pi pi-bars" class="p-button-rounded menu-toggle"></button>
    </header>

    <!-- Content Area -->
    <div class="content-area">
      <!-- Vista: Perfil del Administrador -->
      <div *ngIf="currentView === 'perfil'" class="profile-view">
        <div class="profile-card">
          <div class="profile-avatar">
            <i class="pi pi-shield"></i>
          </div>
          <h2>{{ adminNombre }}</h2>
          <p class="email">{{ adminEmail }}</p>
          <p class="role">Administrador</p>
          
          <div class="stats-grid">
            <div class="stat-card">
              <i class="pi pi-file"></i>
              <span class="stat-value">{{ solicitudesPublicacion.length }}</span>
              <span class="stat-label">Solicitudes Publicación</span>
            </div>
            <div class="stat-card">
              <i class="pi pi-users"></i>
              <span class="stat-value">{{ solicitudesOwner.length }}</span>
              <span class="stat-label">Solicitudes Anfitriones</span>
            </div>
            <div class="stat-card">
              <i class="pi pi-user"></i>
              <span class="stat-value">{{ usuarios.length }}</span>
              <span class="stat-label">Usuarios Totales</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Vista: Solicitudes de Publicación -->
      <div *ngIf="currentView === 'solicitud-publicaciones'" class="solicitudes-view">
        <div *ngIf="loading" class="loading">
          <i class="pi pi-spin pi-spinner"></i>
          <p>Cargando solicitudes...</p>
        </div>

        <div *ngIf="!loading && solicitudesPublicacion.length === 0" class="empty-state">
          <i class="pi pi-inbox"></i>
          <p>No hay solicitudes de publicación pendientes</p>
        </div>

        <p-table 
          *ngIf="!loading && solicitudesPublicacion.length > 0"
          [value]="solicitudesPublicacion" 
          styleClass="p-datatable-striped"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>ID</th>
              <th>Alojamiento</th>
              <th>Anfitrión</th>
              <th>Fecha</th>
              <th>Comentarios</th>
              <th>Acciones</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-solicitud>
            <tr>
              <td>{{ solicitud.id }}</td>
              <td>{{ solicitud.alojamientoNombre }}</td>
              <td>{{ solicitud.ownerNombre }}</td>
              <td>{{ formatDate(solicitud.fechaSolicitud) }}</td>
              <td>{{ solicitud.comentarios || 'N/A' }}</td>
              <td>
                <button 
                  pButton 
                  label="Aprobar" 
                  icon="pi pi-check" 
                  class="p-button-success p-button-sm"
                  (click)="responderSolicitudPublicacion(solicitud, true)"
                ></button>
                <button 
                  pButton 
                  label="Rechazar" 
                  icon="pi pi-times" 
                  class="p-button-danger p-button-sm"
                  style="margin-left: 8px;"
                  (click)="responderSolicitudPublicacion(solicitud, false)"
                ></button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <!-- Vista: Solicitudes de Anfitriones -->
      <div *ngIf="currentView === 'solicitud-anfitriones'" class="solicitudes-view">
        <div *ngIf="loading" class="loading">
          <i class="pi pi-spin pi-spinner"></i>
          <p>Cargando solicitudes...</p>
        </div>

        <div *ngIf="!loading && solicitudesOwner.length === 0" class="empty-state">
          <i class="pi pi-inbox"></i>
          <p>No hay solicitudes de anfitriones pendientes</p>
        </div>

        <p-table 
          *ngIf="!loading && solicitudesOwner.length > 0"
          [value]="solicitudesOwner" 
          styleClass="p-datatable-striped"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>ID</th>
              <th>Usuario</th>
              <th>Email</th>
              <th>Fecha</th>
              <th>Comentarios</th>
              <th>Documento</th>
              <th>Acciones</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-solicitud>
            <tr>
              <td>{{ solicitud.id }}</td>
              <td>{{ solicitud.usuarioNombre }}</td>
              <td>{{ solicitud.usuarioEmail }}</td>
              <td>{{ formatDate(solicitud.fechaSolicitud) }}</td>
              <td>{{ solicitud.comentarios || 'N/A' }}</td>
              <td>
                <a *ngIf="solicitud.documentoUrl" [href]="solicitud.documentoUrl" target="_blank">
                  <i class="pi pi-file-pdf"></i> Ver
                </a>
                <span *ngIf="!solicitud.documentoUrl">N/A</span>
              </td>
              <td>
                <button 
                  pButton 
                  label="Aprobar" 
                  icon="pi pi-check" 
                  class="p-button-success p-button-sm"
                  (click)="responderSolicitudOwner(solicitud, true)"
                ></button>
                <button 
                  pButton 
                  label="Rechazar" 
                  icon="pi pi-times" 
                  class="p-button-danger p-button-sm"
                  style="margin-left: 8px;"
                  (click)="responderSolicitudOwner(solicitud, false)"
                ></button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <!-- Vista: Asignar Rol -->
      <div *ngIf="currentView === 'asignar-rol'" class="asignar-rol-view">
        <div class="view-header">
          <h3>Gestionar roles de usuarios</h3>
          <button pButton label="Recargar Lista" icon="pi pi-refresh" (click)="loadUsuarios()"></button>
        </div>

        <div *ngIf="loading" class="loading">
          <i class="pi pi-spin pi-spinner"></i>
          <p>Cargando usuarios...</p>
        </div>

        <div class="usuarios-grid" *ngIf="!loading">
          <div class="usuario-card" *ngFor="let usuario of usuarios">
            <div class="usuario-header">
              <i class="pi pi-user"></i>
              <span class="role-badge" [ngClass]="'role-' + usuario.role.toLowerCase()">
                {{ getRoleLabel(usuario.role) }}
              </span>
            </div>
            <h4>{{ usuario.nombre }}</h4>
            <p class="email">{{ usuario.email }}</p>
            <p class="phone" *ngIf="usuario.telefono">
              <i class="pi pi-phone"></i> {{ usuario.telefono }}
            </p>
            <button 
              pButton 
              label="Cambiar Rol" 
              icon="pi pi-pencil" 
              class="p-button-sm"
              (click)="openAsignarRolDialog(usuario)"
            ></button>
          </div>
        </div>
      </div>

      <!-- Vista: Listar Usuarios -->
      <div *ngIf="currentView === 'listar-usuarios'" class="listar-view">
        <div class="view-header">
          <h3>Todos los usuarios</h3>
          <button pButton label="Recargar" icon="pi pi-refresh" (click)="loadUsuarios()"></button>
        </div>

        <div *ngIf="loading" class="loading">
          <i class="pi pi-spin pi-spinner"></i>
          <p>Cargando usuarios...</p>
        </div>

        <p-table 
          *ngIf="!loading"
          [value]="usuarios" 
          styleClass="p-datatable-striped"
          [paginator]="true"
          [rows]="10"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Teléfono</th>
              <th>Fecha Registro</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-usuario>
            <tr>
              <td>{{ usuario.id }}</td>
              <td>{{ usuario.nombre }}</td>
              <td>{{ usuario.email }}</td>
              <td>
                <span class="role-badge" [ngClass]="'role-' + usuario.role.toLowerCase()">
                  {{ getRoleLabel(usuario.role) }}
                </span>
              </td>
              <td>{{ usuario.telefono || 'N/A' }}</td>
              <td>{{ formatDate(usuario.fechaRegistro) }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <!-- Vista: Listar por Rol -->
      <div *ngIf="currentView === 'listar-por-rol'" class="listar-por-rol-view">
        <div class="filter-section">
          <h3>Filtrar usuarios por rol</h3>
          <mat-form-field appearance="outline">
            <mat-label>Selecciona un rol</mat-label>
            <mat-select [(ngModel)]="selectedRoleFiltro" (selectionChange)="loadUsuariosPorRol()">
              <mat-option [value]="'CLIENT'">Cliente</mat-option>
              <mat-option [value]="'OWNER'">Anfitrión</mat-option>
              <mat-option [value]="'ADMIN'">Administrador</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div *ngIf="loading" class="loading">
          <i class="pi pi-spin pi-spinner"></i>
          <p>Cargando usuarios...</p>
        </div>

        <div *ngIf="!loading && !selectedRoleFiltro" class="empty-state">
          <i class="pi pi-filter"></i>
          <p>Selecciona un rol para filtrar usuarios</p>
        </div>

        <p-table 
          *ngIf="!loading && selectedRoleFiltro && usuariosFiltrados.length > 0"
          [value]="usuariosFiltrados" 
          styleClass="p-datatable-striped"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Teléfono</th>
              <th>Fecha Registro</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-usuario>
            <tr>
              <td>{{ usuario.id }}</td>
              <td>{{ usuario.nombre }}</td>
              <td>{{ usuario.email }}</td>
              <td>{{ usuario.telefono || 'N/A' }}</td>
              <td>{{ formatDate(usuario.fechaRegistro) }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <!-- Vista: Crear Usuario -->
      <div *ngIf="currentView === 'crear-usuario'" class="crear-usuario-view">
        <div class="form-container">
          <h3>Crear nuevo usuario</h3>
          
          <div class="form-content">
            <div class="form-field">
              <label>Nombre completo</label>
              <input type="text" pInputText [(ngModel)]="nuevoUsuario.nombre" placeholder="Juan Pérez" />
            </div>

            <div class="form-field">
              <label>Email</label>
              <input type="email" pInputText [(ngModel)]="nuevoUsuario.email" placeholder="juan@example.com" />
            </div>

            <div class="form-field">
              <label>Contraseña</label>
              <input type="password" pInputText [(ngModel)]="nuevoUsuario.password" placeholder="••••••••" />
            </div>

            <div class="form-field">
              <label>Teléfono (opcional)</label>
              <input type="tel" pInputText [(ngModel)]="nuevoUsuario.telefono" placeholder="3001234567" />
            </div>

            <div class="form-field">
              <label>Rol inicial</label>
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Selecciona rol</mat-label>
                <mat-select [(ngModel)]="selectedRole">
                  <mat-option [value]="'CLIENT'">Cliente</mat-option>
                  <mat-option [value]="'OWNER'">Anfitrión</mat-option>
                  <mat-option [value]="'ADMIN'">Administrador</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <button pButton label="Crear Usuario" icon="pi pi-user-plus" (click)="crearUsuario()"></button>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Dialog: Asignar Rol -->
<p-dialog 
  [(visible)]="showAsignarRolDialog" 
  header="Asignar Rol"
  [modal]="true"
  [style]="{width: '450px'}"
>
  <div class="dialog-content" *ngIf="selectedUsuario">
    <p>Asignar rol a: <strong>{{ selectedUsuario.nombre }}</strong></p>
    <p class="current-role">Rol actual: <span class="role-badge">{{ getRoleLabel(selectedUsuario.role) }}</span></p>
    
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nuevo rol</mat-label>
      <mat-select [(ngModel)]="selectedRole">
        <mat-option [value]="'CLIENT'">Cliente</mat-option>
        <mat-option [value]="'OWNER'">Anfitrión</mat-option>
        <mat-option [value]="'ADMIN'">Administrador</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <ng-template pTemplate="footer">
    <button pButton label="Cancelar" class="p-button-text" (click)="showAsignarRolDialog = false"></button>
    <button pButton label="Asignar" (click)="asignarRol()"></button>
  </ng-template>
</p-dialog>

<!-- Dialog: Respuesta/Rechazo -->
<p-dialog 
  [(visible)]="showRespuestaDialog" 
  header="Motivo del Rechazo"
  [modal]="true"
  [style]="{width: '500px'}"
>
  <div class="dialog-content">
    <p>Agrega un comentario explicando el motivo del rechazo:</p>
    <textarea 
      pInputTextarea 
      [(ngModel)]="respuestaComentario" 
      rows="4" 
      placeholder="Escribe aquí el motivo..."
      style="width: 100%;"
    ></textarea>
  </div>

  <ng-template pTemplate="footer">
    <button pButton label="Cancelar" class="p-button-text" (click)="showRespuestaDialog = false"></button>
    <button 
      pButton 
      label="Confirmar Rechazo" 
      class="p-button-danger"
      (click)="currentView === 'solicitud-anfitriones' ? confirmarRechazoSolicitudOwner() : confirmarRespuestaSolicitudPublicacion(false)"
    ></button>
  </ng-template>
</p-dialog>